<%- include('partials/sidebar') %>

    <main class="dashboard-main">
        <div class="dashboard-header">
            <div>
                <a href="/dashboard" style="color: #a1a1aa; font-size: 0.875rem;">â† Dashboard</a>
                <h1 class="dashboard-header__title">
                    <%= guild.name %> AyarlarÄ±
                </h1>
            </div>
        </div>

        <div class="dashboard-settings">
            <form id="settingsForm">
                <!-- DJ Role -->
                <div class="dashboard-settings__section">
                    <h3 class="dashboard-settings__title">ğŸ­ DJ RolÃ¼</h3>
                    <div class="form-group">
                        <label for="djRoleId">DJ RolÃ¼ ID (boÅŸ bÄ±rakÄ±labilir)</label>
                        <input type="text" id="djRoleId" name="djRoleId" class="form-input"
                            value="<%= settings.djRoleId || '' %>" placeholder="Rol ID girin veya boÅŸ bÄ±rakÄ±n">
                        <small style="color: #71717a; margin-top: 0.5rem; display: block;">
                            DJ kontrolÃ¼ iÃ§in gerekli rolÃ¼ ayarlayÄ±n. BoÅŸ bÄ±rakÄ±lÄ±rsa herkes mÃ¼zik kontrolÃ¼ yapabilir.
                        </small>
                    </div>
                </div>

                <!-- Default Volume -->
                <div class="dashboard-settings__section">
                    <h3 class="dashboard-settings__title">ğŸ”Š VarsayÄ±lan Ses Seviyesi</h3>
                    <div class="form-group">
                        <label for="defaultVolume">Ses Seviyesi: <span id="volumeValue">
                                <%= settings.defaultVolume %>
                            </span>%</label>
                        <input type="range" id="defaultVolume" name="defaultVolume" class="form-range" min="1" max="100"
                            value="<%= settings.defaultVolume %>"
                            onchange="document.getElementById('volumeValue').textContent = this.value">
                    </div>
                </div>

                <!-- Now Playing Announcements -->
                <div class="dashboard-settings__section">
                    <h3 class="dashboard-settings__title">ğŸ“¢ ÅarkÄ± Bildirimleri</h3>
                    <div class="form-group">
                        <label class="form-checkbox">
                            <input type="checkbox" id="announceNowPlaying" name="announceNowPlaying"
                                <%=settings.announceNowPlaying ? 'checked' : '' %>>
                            <span>Yeni ÅŸarkÄ± baÅŸladÄ±ÄŸÄ±nda mesaj gÃ¶nder</span>
                        </label>
                    </div>
                </div>

                <!-- Auto Leave -->
                <div class="dashboard-settings__section">
                    <h3 class="dashboard-settings__title">ğŸ‘‹ Otomatik AyrÄ±lma</h3>
                    <div class="form-group">
                        <label for="autoLeaveMinutes">BoÅŸ kanalda beklenecek sÃ¼re (dakika)</label>
                        <select id="autoLeaveMinutes" name="autoLeaveMinutes" class="form-select">
                            <% [1, 2, 3, 5, 10, 15, 30].forEach(min=> { %>
                                <option value="<%= min %>" <%=settings.autoLeaveMinutes===min ? 'selected' : '' %>>
                                    <%= min %> dakika
                                </option>
                                <% }) %>
                        </select>
                    </div>
                </div>

                <!-- Language -->
                <div class="dashboard-settings__section">
                    <h3 class="dashboard-settings__title">ğŸŒ Dil</h3>
                    <div class="form-group">
                        <label for="language">Bot Dili</label>
                        <select id="language" name="language" class="form-select">
                            <option value="tr" <%=settings.language==='tr' ? 'selected' : '' %>>TÃ¼rkÃ§e</option>
                            <option value="en" <%=settings.language==='en' ? 'selected' : '' %>>English</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="btn btn--primary btn--lg" style="width: 100%;">
                    ğŸ’¾ Kaydet
                </button>
            </form>
        </div>
    </main>

    <!-- Mobile Toggle -->
    <button class="dashboard-toggle" onclick="toggleSidebar()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 12h18M3 6h18M3 18h18" />
        </svg>
    </button>

    <script>
        function toggleSidebar() {
            document.querySelector('.dashboard-sidebar').classList.toggle('active');
        }

        document.getElementById('settingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = {
                djRoleId: document.getElementById('djRoleId').value,
                defaultVolume: parseInt(document.getElementById('defaultVolume').value),
                announceNowPlaying: document.getElementById('announceNowPlaying').checked,
                autoLeaveMinutes: parseInt(document.getElementById('autoLeaveMinutes').value),
                language: document.getElementById('language').value
            };

            try {
                const response = await fetch('/api/servers/<%= guild.id %>/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    alert('Ayarlar kaydedildi!');
                } else {
                    const data = await response.json();
                    alert(data.error || 'Bir hata oluÅŸtu!');
                }
            } catch (err) {
                alert('Bir hata oluÅŸtu!');
            }
        });
    </script>
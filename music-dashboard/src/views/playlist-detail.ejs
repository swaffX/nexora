<%- include('partials/sidebar') %>

    <main class="dashboard-main">
        <div class="dashboard-header">
            <div>
                <a href="/dashboard/playlists" style="color: #a1a1aa; font-size: 0.875rem;">â† Playlistler</a>
                <h1 class="dashboard-header__title">
                    <%= playlist.name %>
                </h1>
                <p class="dashboard-header__subtitle">
                    <%= playlist.tracks.length %> ÅŸarkÄ±
                </p>
            </div>
            <div class="dashboard-header__actions">
                <button class="btn btn--secondary btn--sm" onclick="renamePlaylist()">âœï¸ Yeniden AdlandÄ±r</button>
                <button class="btn btn--danger btn--sm" onclick="deletePlaylist()">ğŸ—‘ï¸ Sil</button>
            </div>
        </div>

        <% if (playlist.tracks.length> 0) { %>
            <div class="card dashboard-tracks">
                <% playlist.tracks.forEach((track, index)=> { %>
                    <div class="dashboard-track">
                        <div class="dashboard-track__info">
                            <span class="dashboard-track__number">
                                <%= index + 1 %>
                            </span>
                            <% if (track.thumbnail) { %>
                                <img src="<%= track.thumbnail %>" alt="" class="dashboard-track__thumb">
                                <% } else { %>
                                    <div class="dashboard-track__thumb"
                                        style="background: #333; display: flex; align-items: center; justify-content: center;">
                                        ğŸµ</div>
                                    <% } %>
                                        <div class="dashboard-track__details">
                                            <div class="dashboard-track__title">
                                                <%= track.title %>
                                            </div>
                                            <div class="dashboard-track__duration">
                                                <%= Math.floor(track.duration / 60) %>:<%= String(track.duration %
                                                        60).padStart(2, '0' ) %>
                                            </div>
                                        </div>
                        </div>
                        <div class="dashboard-track__actions">
                            <button class="btn btn--ghost btn--icon" onclick="removeTrack(<%= index %>)" title="KaldÄ±r">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                    <% }) %>
            </div>
            <% } else { %>
                <div class="empty-state">
                    <div class="empty-state__icon">ğŸµ</div>
                    <h3 class="empty-state__title">Bu playlist boÅŸ</h3>
                    <p class="empty-state__desc">Discord'da ÅŸarkÄ± Ã§alarken <code>/playlist add</code> komutu ile ÅŸarkÄ±
                        ekleyebilirsin.</p>
                </div>
                <% } %>
    </main>

    <!-- Mobile Toggle -->
    <button class="dashboard-toggle" onclick="toggleSidebar()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 12h18M3 6h18M3 18h18" />
        </svg>
    </button>

    <script>
        const playlistId = '<%= playlist._id %>';

        function toggleSidebar() {
            document.querySelector('.dashboard-sidebar').classList.toggle('active');
        }

        async function renamePlaylist() {
            const newName = prompt('Yeni playlist adÄ±:', '<%= playlist.name %>');
            if (!newName || newName === '<%= playlist.name %>') return;

            try {
                const response = await fetch(`/api/playlists/${playlistId}`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: newName })
                });
                if (response.ok) {
                    window.location.reload();
                } else {
                    alert('Yeniden adlandÄ±rÄ±lamadÄ±!');
                }
            } catch (err) {
                alert('Bir hata oluÅŸtu!');
            }
        }

        async function deletePlaylist() {
            if (!confirm('Bu playlisti silmek istediÄŸinize emin misiniz?')) return;

            try {
                const response = await fetch(`/api/playlists/${playlistId}`, { method: 'DELETE' });
                if (response.ok) {
                    window.location.href = '/dashboard/playlists';
                } else {
                    alert('Playlist silinemedi!');
                }
            } catch (err) {
                alert('Bir hata oluÅŸtu!');
            }
        }

        async function removeTrack(index) {
            if (!confirm('Bu ÅŸarkÄ±yÄ± kaldÄ±rmak istediÄŸinize emin misiniz?')) return;

            try {
                const response = await fetch(`/api/playlists/${playlistId}/tracks/${index}`, { method: 'DELETE' });
                if (response.ok) {
                    window.location.reload();
                } else {
                    alert('ÅarkÄ± kaldÄ±rÄ±lamadÄ±!');
                }
            } catch (err) {
                alert('Bir hata oluÅŸtu!');
            }
        }
    </script>